Name

    ANGLE_metal_shared_event_sync

Name Strings

    EGL_ANGLE_metal_shared_event_sync

Contributors

    Dan Glastonbury, Apple

Contacts

    Dan Glastonbury, Apple (djg 'at' apple.com)

Status

    Draft

Version

    Version 1, 2022-05-17

Number

    EGL Extensions XXX

Extension Type

    EGL display extension

Dependencies

    This extension is written against the wording of the EGL 1.5
    Specification.

Overview

    This extension enables the creation of EGL fence sync objects that are
    associated with a native Metal event object.  The EGL fence sync objects
    have nearly identical semantics to those sync objects defined by the
    EGL 1.5 Specification, except that they have an additional attribute
    storing the id<MTLSharedEvent> referring to the metal event object and
    the integer value to signal the event with.

New Types

    None.

New Procedures and Functions

    None.

New Tokens

    Accepted by the <type> parameter of eglCreateSync, and returned
    in <value> when eglGetSyncAttrib is called with <attribute>
    EGL_SYNC_TYPE:

    EGL_SYNC_METAL_SHARED_EVENT_ANGLE                   0x34D8

    Accepted by the <attrib_list> parameter of eglCreateSync:

    EGL_SYNC_METAL_SHARED_EVENT_OBJECT_ANGLE            0x34D9
    EGL_SYNC_METAL_SHARED_EVENT_SIGNAL_VALUE_LO_ANGLE   0x34DA
    EGL_SYNC_METAL_SHARED_EVENT_SIGNAL_VALUE_HI_ANGLE   0x34DA

Additions to the EGL Specification

    Add the following after the first paragraph of Section 3.8.1.1 (Creating
    Fence Sync Objects),

    "If <type> is EGL_SYNC_METAL_SHARED_EVENT_ANGLE, an EGL metal event sync
    object is created. In this case the
    EGL_SYNC_METAL_SHARED_EVENT_OBJECT_ANGLE,
    EGL_SYNC_METAL_SHARED_EVENT_SIGNAL_VALUE_LO_ANGLE, and
    EGL_SYNC_METAL_SHARED_EVENT_SIGNAL_VALUE_HI_ANGLE may be specified. If
    EGL_SYNC_METAL_SHARED_EVENT_OBJECT_ANGLE is specified, it must be set to
    either a valid MTLSharedEvent else EGL_NO_SYNC is returned and an
    EGL_BAD_ATTRIBUTE error is generated.

    EGL_SYNC_METAL_SHARED_EVENT_SIGNAL_VALUE_LO_ANGLE and
    EGL_SYNC_METAL_SHARED_EVENT_HI_ANGLE are optional attributes specifying the
    low and high 32-bit parts of an unsigned 64-bit value to be set when the
    event is signaled. If these attributes are unspecified, the event is
    signaled with one more than the event's signaledValue property at the time
    of EGLSync creation. The signal value will wrap to 0 if the initial
    signaledValue is the maximum value for uint64_t.

    The default values for the EGL metal event sync object attributes are as
    follows:

      Attribute Name                     Initial Attribute Value(s)
      --------------                     --------------------------
      EGL_SYNC_TYPE                      EGL_SYNC_METAL_SHARED_EVENT_ANGLE
      EGL_SYNC_STATUS                    EGL_UNSIGNALED
      EGL_SYNC_CONDITION                 EGL_SYNC_PRIOR_COMMANDS_COMPLETE

    Modify the list of eglCreateSync errors in Section 3.8.1.2 (Creating OpenCL
    Event Sync Objects)

    "Errors
     ------
    ..."

Issues

    1. What should the name be? METAL_EVENT_ANGLE? MTL or METAL?
    2. Add language describing the behaviour of
       EGL_SYNC_METAL_SHARED_EVENT_SIGNAL_VALUE_ANGLE.

Revision History

    Version 1, 2022-05-17
      - Initial draft
